<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedOrganiza - Economize em seus remédios</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Manrope:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="logo.png">
    <style>
        :root { 
            --font-title: 'Manrope', system-ui, sans-serif; 
            --font-body: 'Inter', system-ui, sans-serif;
            --brand: #2cb67d;
            --brand-dark: #259668;
            --primary: #4a6bff;
            --secondary: #6c63ff;
            --success: #28a745;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
        }
        
        * {
            box-sizing: border-box;
        }
        
        h1,h2,h3,h4,h5,h6 { 
            font-family: var(--font-title); 
            letter-spacing: -0.02em; 
        }
        
        body { 
            font-family: var(--font-body); 
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }
        
        .logo i {
            font-size: 2rem;
            color: var(--brand);
            margin-right: 10px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            color: var(--brand);
            font-weight: 700;
            margin: 0;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 1rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 15px;
            padding: 0 10px;
        }
        
        .form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .form-section {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid var(--light);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
            background-color: #fff;
            color: #333;
            height: 42px;
            box-sizing: border-box;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--brand);
            box-shadow: 0 0 0 2px rgba(44, 182, 125, 0.2);
        }
        
        .help-text {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 4px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
            margin-top: 4px;
        }
        
        .checkbox-group label {
            margin-bottom: 10px;
            margin-top: 14px;
            font-size: 15px;
        }
        
        .medication-block {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--brand);
            position: relative;
        }
        
        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .medication-title {
            font-weight: 600;
            color: var(--brand);
            font-size: 1rem;
        }
        
        .remove-medication {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.1rem;
            display: none;
        }
        
        .medication-block:not(:first-child) .remove-medication {
            display: block;
        }
        
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 100%;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 12px 0;
            font-size: 0.95rem;
            text-align: center;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn:hover {
            background-color: var(--brand-dark);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--brand);
            color: var(--brand);
        }
        
        .btn-outline:hover {
            background-color: rgba(44, 182, 125, 0.1);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-add {
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .plan-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .plan-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .plan-card:hover {
            border-color: var(--brand);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .plan-card.selected {
            border-color: var(--brand);
            background-color: rgba(44, 182, 125, 0.05);
        }
        
        .plan-card h3 {
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .plan-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--brand);
            margin-bottom: 8px;
        }
        
        .plan-features {
            font-size: 0.85rem;
            color: var(--gray);
            text-align: left;
            margin-top: 10px;
            padding-left: 5px;
        }
        
        .plan-features li {
            margin-bottom: 5px;
            list-style-type: none;
            position: relative;
            padding-left: 20px;
        }
        
        .plan-features li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--success);
        }
        
        .form-footer {
            margin-top: 20px;
            padding-bottom: 20px;
            text-align: center;
        }
        
        .summary-container {
            display: none;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .summary-title {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .summary-section {
            margin-bottom: 20px;
        }
        
        .summary-section h3 {
            font-size: 1.1rem;
            color: var(--brand);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--light);
        }
        
        .summary-item {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .summary-label {
            font-weight: 500;
            color: var(--gray);
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        
        .summary-value {
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .medication-summary {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .medication-summary-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--brand);
            font-size: 1rem;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .action-buttons .btn {
            flex: 1;
            min-width: 100%;
        }
        
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
        }
        
        .whatsapp-btn:hover {
            background-color: #128C7E;
        }
        
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            left: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
            max-width: 100%;
            border-left: 4px solid var(--brand);
        }
        
        .notification.success {
            border-left-color: var(--success);
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        .notification.warning {
            border-left-color: #ffc107;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .notification-message {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .notification-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .notification-buttons {
            margin-top: 12px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        
        .notification-buttons .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        /* Media Queries para telas maiores */
        @media (min-width: 600px) {
            .container {
                padding: 20px;
            }
            .form-container {
                padding: 20px;
                margin-bottom: 25px;
            }
            .form-section {
                margin-bottom: 25px;
            }
            .form-group {
                margin-bottom: 18px;
            }
            .form-row {
                flex-direction: row;
                gap: 15px;
            }
            .form-row .form-group {
                flex: 1;
                min-width: 200px;
            }
            .form-row .form-group:first-child {
                flex: 0 0 200px;
            }
            .form-row .form-group:last-child {
                flex: 1;
            }
            .form-footer {
                margin-top: 25px;
                padding-bottom: 25px;
            }
            .btn {
                width: auto;
                padding: 12px 24px;
            }
            .plan-options {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .plan-card {
                flex: 1;
                min-width: 200px;
            }
            .action-buttons {
                flex-direction: row;
            }
            .action-buttons .btn {
                min-width: 200px;
            }
            .summary-item {
                flex-direction: row;
            }
            .summary-label {
                width: 180px;
                margin-bottom: 0;
                flex-shrink: 0;
            }
            .summary-value {
                flex: 1;
                min-width: 200px;
            }
            .notification {
                left: auto;
                max-width: 350px;
            }
        }
        
        @media (min-width: 1024px) {
            .container {
                padding: 30px;
            }
            .form-container {
                padding: 30px;
                margin-bottom: 30px;
            }
            .summary-container {
                padding: 30px;
            }
        }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 5px;
    }
    /* Header */
    .header {
        position: auto;
        top: 0;
        width: 100%;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
    }
    .header-content {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: auto;
        gap: auto;
    }
    .logo {
        width: 50px;
        height: 50px;
        object-fit: contain;
    }
    .brand {
        font-size: 25px;
        font-weight: bold;
        color: #2563eb;
    }

    /* Estilo para o datepicker */
    .date-input-wrapper {
        position: relative;
    }
    
    .date-input-wrapper input[type="date"] {
        padding-right: 40px;
    }
    
    .date-input-wrapper .calendar-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
        pointer-events: none;
    }
    
    /* Impedir digitação manual no campo de data */
    input[type="date"]::-webkit-calendar-picker-indicator {
        cursor: pointer;
    }
    
    input[type="date"]::-webkit-inner-spin-button,
    input[type="date"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    
    input[type="date"] {
        -moz-appearance: textfield;
    }

    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <img
                        src="logo.png"
                        alt="MedOrganiza" 
                        class="logo">
                    <div class="brand">MedOrganiza</div>
                </div>
            </div>
        </header>
    
        <div class="form-container" id="form-container">
            <form id="medication-form">
                <!-- Dados do usuário -->
                <div class="form-section">
                    <h2 class="section-title">Seus dados</h2>
                    <div class="form-group">
                        <label for="nome">Nome completo</label>
                        <input type="text" id="nome" name="nome" placeholder="Maria Souza" required>
                    </div>
                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" name="email" placeholder="mariasouza@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="whatsapp">WhatsApp (com DDD)</label>
                        <input type="tel" id="whatsapp" name="whatsapp" placeholder="11 91234-5678" required>
                    </div>
                </div>
                <!-- Escolha do plano e pagamento -->
                <div class="form-section">
                    <h2 class="section-title">Escolha seu plano</h2>
                    <div class="plan-options">
                        <div class="plan-card" data-plan="Grátis">
                            <h3>Grátis</h3>
                            <div class="plan-price">R$ 0/mês</div>
                            <ul class="plan-features">
                                <li>1 medicamento</li>
                                <li>1 alerta</li>
                                <li>Compara 2 farmácias</li>
                                <li>Alertas no WhatsApp</li>
                            </ul>
                        </div>
                        <div class="plan-card" data-plan="Pessoal">
                            <h3>Pessoal</h3>
                            <div class="plan-price">R$ 14,90/mês</div>
                            <ul class="plan-features">
                                <li>Até 5 medicamentos</li>
                                <li>Alertas + lembretes</li>
                                <li>Compara 3 farmácias</li>
                                <li>PDF mensal com preços</li>
                            </ul>
                        </div>
                        <div class="plan-card" data-plan="Premium">
                            <h3>Premium</h3>
                            <div class="plan-price">R$ 29,90/mês</div>
                            <ul class="plan-features">
                                <li>Medicamentos ilimitados</li>
                                <li>Compara todas as farmácias</li>
                                <li>Avisa quando preço cai</li>
                                <li>PDF semanal</li>
                                <li>Olha se tem no SUS</li>
                                <li>Atendimento rápido</li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="metodo_pagamento">Método de pagamento preferido</label>
                        <select id="metodo_pagamento" name="metodo_pagamento">
                            <option value="">Selecione uma opção</option>
                            <option value="PIX">PIX</option>
                            <option value="Cartão">Cartão</option>
                            <option value="Boleto">Boleto</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="codigo_founder">Código Founder (opcional)</label>
                        <input type="text" id="codigo_founder" name="codigo_founder" placeholder="Ex.: FND-0023">
                    </div>
                </div>
                <!-- Seus medicamentos -->
                <div class="form-section">
                    <h2 class="section-title">Seus medicamentos</h2>
                    <div id="medications-container">
                        <div class="medication-block">
                            <div class="medication-header">
                                <div class="medication-title">Medicamento principal</div>
                                <button type="button" class="remove-medication"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="form-group">
                                <label for="medicamento-0">Nome do medicamento</label>
                                <input type="text" id="medicamento-0" name="medicamento" placeholder="Ex.: Ozempic" required>
                            </div>
                            <div class="form-group">
                                <label for="dosagem-0">Dosagem</label>
                                <input type="text" id="dosagem-0" name="dosagem" placeholder="Ex.: 1 mg / 1 mL" required>
                            </div>
                            <div class="form-group">
                                <label for="marca-0">Marca</label>
                                <select id="marca-0" name="marca" required>
                                    <option value="">Selecione uma opção</option>
                                    <option value="Referência/Marca">Referência/Marca</option>
                                    <option value="Genérico">Genérico</option>
                                    <option value="Não sei">Não sei</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="quantidade-0">Quantidade comprada na última compra</label>
                                <input type="text" id="quantidade-0" name="quantidade" placeholder="Ex: 4 canetas ou 30 comprimidos" required>
                            </div>
                            <div class="form-group">
                                <label for="forma_uso-0">Como usa (posologia)</label>
                                <input type="text" id="forma_uso-0" name="forma_uso" placeholder="Ex: 1 comprimido 2 vezes ao dia" required>
                                <div class="help-text">Ex.: 1 comp. 2x/dia • 1 caneta/semana.</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="data_compra-0">Data da última compra</label>
                                    <div class="date-input-wrapper">
                                        <input type="date" id="data_compra-0" name="data_compra" required>
                                        <i class="fas fa-calendar-alt calendar-icon"></i>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="dias_antes_alerta-0">Quer ser avisado com quantos dias de antecedência? (opcional)</label>
                                    <input type="number" id="dias_antes_alerta-0" name="dias_antes_alerta" min="1" max="7" placeholder="5">
                                    <div class="help-text">Recomendado: 5 a 7 dias.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline btn-add" id="add-medication" style="display: none;">
                        <i class="fas fa-plus"></i> Adicionar outro medicamento
                    </button>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="lgpd" name="lgpd" required>
                    <label for="lgpd">Aceito ser contatado pelo WhatsApp e e-mail</label>
                </div>
                <div class="form-footer">
                    <button type="submit" class="btn btn-success btn-block" id="submit-btn">Quero ver onde está mais barato</button>
                </div>
            </form>
        </div>
        <div class="summary-container" id="summary-container">
            <h2 class="summary-title">Resumo do seu cadastro</h2>
            <div class="summary-section">
                <h3>Seus dados</h3>
                <div class="summary-item">
                    <div class="summary-label">Nome:</div>
                    <div class="summary-value" id="summary-nome"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">E-mail:</div>
                    <div class="summary-value" id="summary-email"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">WhatsApp:</div>
                    <div class="summary-value" id="summary-whatsapp"></div>
                </div>
            </div>
            <div class="summary-section">
                <h3>Seus medicamentos</h3>
                <div id="summary-medications"></div>
            </div>
            <div class="summary-section">
                <h3>Plano escolhido</h3>
                <div class="summary-item">
                    <div class="summary-label">Plano:</div>
                    <div class="summary-value" id="summary-plano"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Método de pagamento:</div>
                    <div class="summary-value" id="summary-metodo-pagamento"></div>
                </div>
                <div class="summary-item" id="summary-codigo-founder-item" style="display: none;">
                    <div class="summary-label">Código Founder:</div>
                    <div class="summary-value" id="summary-codigo-founder"></div>
                </div>
            </div>
            <div class="action-buttons">
                <a href="#" class="btn whatsapp-btn" id="whatsapp-link">
                    <i class="fab fa-whatsapp"></i> Receber comparativo no WhatsApp
                </a>
                <button class="btn btn-success" id="subscribe-btn">Assinar agora</button>
            </div>
        </div>
    </div>
    <div class="notification" id="notification">
        <button class="notification-close" id="notification-close">&times;</button>
        <div class="notification-title" id="notification-title"></div>
        <div class="notification-message" id="notification-message"></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variáveis globais
            let medicationCount = 1;
            let selectedPlan = '';
            let previousPlan = '';
            
            // Elementos do DOM
            const whatsappInput = document.getElementById('whatsapp');
            const addMedicationBtn = document.getElementById('add-medication');
            const medicationsContainer = document.getElementById('medications-container');
            const planCards = document.querySelectorAll('.plan-card');
            const form = document.getElementById('medication-form');
            const formContainer = document.getElementById('form-container');
            const summaryContainer = document.getElementById('summary-container');
            const notification = document.getElementById('notification');
            const notificationClose = document.getElementById('notification-close');
            
            // Função para formatar a data no formato YYYY-MM-DD
            function formatDateToYYYYMMDD(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            
            // Função para definir a data mínima como hoje e configurar o campo de data
            function setupDateInput(dateInput) {
                const today = new Date();
                const todayString = formatDateToYYYYMMDD(today);
                
                // Define a data mínima como hoje
                dateInput.setAttribute('min', todayString);
                
                // Impede a digitação manual
                dateInput.addEventListener('keydown', function(e) {
                    e.preventDefault();
                    return false;
                });
                
                // Adiciona um evento para validar a data quando ela mudar
                dateInput.addEventListener('change', function() {
                    validateDate(this);
                });
                
                // Adiciona um evento para focar no campo quando clicar no ícone do calendário
                const calendarIcon = dateInput.parentElement.querySelector('.calendar-icon');
                if (calendarIcon) {
                    calendarIcon.addEventListener('click', function() {
                        dateInput.focus();
                        dateInput.click();
                    });
                }
            }
            
            // Função para validar se a data é válida (não é anterior a hoje)
            function validateDate(dateInput) {
                // Obter a data atual formatada
                const today = new Date();
                const todayString = formatDateToYYYYMMDD(today);
                
                // Obter a data selecionada
                const selectedDateString = dateInput.value;
                
                // Comparar as strings diretamente
                if (selectedDateString < todayString) {
                    // Se a data for anterior a hoje, limpa o campo e mostra notificação
                    dateInput.value = '';
                    showNotification('error', 'Data inválida', 'A data da compra não pode ser anterior a hoje. Por favor, selecione uma data válida.');
                    return false;
                }
                
                return true;
            }
            
            // Aplicar a configuração ao primeiro campo de data
            const firstDateInput = document.getElementById('data_compra-0');
            if (firstDateInput) {
                setupDateInput(firstDateInput);
            }
            
            // Máscara para WhatsApp
            whatsappInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                let formattedValue = '';
                if (value.length > 0) {
                    formattedValue = '+55 (';
                    if (value.length > 2) {
                        formattedValue += value.substring(0, 2) + ') ';
                        if (value.length > 3) {
                            formattedValue += value.substring(2, 3);
                            if (value.length > 7) {
                                formattedValue += value.substring(3, 7) + '-';
                                if (value.length > 11) {
                                    formattedValue += value.substring(7, 11);
                                } else {
                                    formattedValue += value.substring(7);
                                }
                            } else {
                                formattedValue += value.substring(3);
                            }
                        } else {
                            formattedValue += value.substring(2);
                        }
                    } else {
                        formattedValue += value;
                    }
                }
                e.target.value = formattedValue;
            });
            
            // Adicionar medicamento
            addMedicationBtn.addEventListener('click', function() {
                const newMedicationBlock = document.createElement('div');
                newMedicationBlock.className = 'medication-block';
                newMedicationBlock.innerHTML = `
                    <div class="medication-header">
                        <div class="medication-title">Medicamento ${medicationCount + 1}</div>
                        <button type="button" class="remove-medication"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="form-group">
                        <label for="medicamento-${medicationCount}">Nome do medicamento</label>
                        <input type="text" id="medicamento-${medicationCount}" name="medicamento" placeholder="Ex.: Ozempic" required>
                    </div>
                    <div class="form-group">
                        <label for="dosagem-${medicationCount}">Dosagem</label>
                        <input type="text" id="dosagem-${medicationCount}" name="dosagem" placeholder="Ex.: 1 mg / 1 mL" required>
                    </div>
                    <div class="form-group">
                        <label for="marca-${medicationCount}">Marca (opcional)</label>
                        <select id="marca-${medicationCount}" name="marca">
                            <option value="">Selecione uma opção</option>
                            <option value="Referência/Marca">Referência/Marca</option>
                            <option value="Genérico">Genérico</option>
                            <option value="Não sei">Não sei</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="quantidade-${medicationCount}">Quantidade comprada na última compra (opcional)</label>
                        <input type="text" id="quantidade-${medicationCount}" name="quantidade" placeholder="Ex.: 4 canetas, 30 comprimidos">
                    </div>
                    <div class="form-group">
                        <label for="forma_uso-${medicationCount}">Como usa (posologia)</label>
                        <input type="text" id="forma_uso-${medicationCount}" name="forma_uso" placeholder="Ex.: 1 comp. 2x/dia" required>
                        <div class="help-text">Ex.: 1 comp. 2x/dia • 1 caneta/semana.</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data_compra-${medicationCount}">Data da última compra</label>
                            <div class="date-input-wrapper">
                                <input type="date" id="data_compra-${medicationCount}" name="data_compra" required>
                                <i class="fas fa-calendar-alt calendar-icon"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="dias_antes_alerta-${medicationCount}">Quer ser avisado com quantos dias de antecedência? (opcional)</label>
                            <input type="number" id="dias_antes_alerta-${medicationCount}" name="dias_antes_alerta" min="1" placeholder="5">
                            <div class="help-text">Recomendado: 5 a 7 dias.</div>
                        </div>
                    </div>
                `;
                medicationsContainer.appendChild(newMedicationBlock);
                medicationCount++;
                
                // Configurar o novo campo de data
                const newDateInput = newMedicationBlock.querySelector(`input[name="data_compra"]`);
                if (newDateInput) {
                    setupDateInput(newDateInput);
                }
                
                // Adicionar evento de remover ao botão
                const removeBtn = newMedicationBlock.querySelector('.remove-medication');
                removeBtn.addEventListener('click', function() {
                    newMedicationBlock.remove();
                    medicationCount--;
                    updateMedicationTitles();
                    checkMedicationLimit();
                });
                
                // Verificar limite de medicamentos conforme o plano selecionado
                checkMedicationLimit();
            });
            
            // Remover medicamento existente
            document.querySelectorAll('.remove-medication').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.medication-block').remove();
                    medicationCount--;
                    updateMedicationTitles();
                    checkMedicationLimit();
                });
            });
            
            // Atualizar títulos dos medicamentos
            function updateMedicationTitles() {
                const medicationBlocks = document.querySelectorAll('.medication-block');
                medicationBlocks.forEach((block, index) => {
                    const titleElement = block.querySelector('.medication-title');
                    if (index === 0) {
                        titleElement.textContent = 'Medicamento principal';
                    } else {
                        titleElement.textContent = `Medicamento ${index + 1}`;
                    }
                });
            }
            
            // Obter limite do plano
            function getPlanLimit(plan) {
                switch(plan) {
                    case 'Grátis':
                        return 1;
                    case 'Pessoal':
                        return 5;
                    case 'Premium':
                        return Infinity;
                    default:
                        return 1;
                }
            }
            
            // Verificar e ajustar limite de medicamentos
            function checkMedicationLimit() {
                const medicationBlocks = document.querySelectorAll('.medication-block');
                const currentMedications = medicationBlocks.length;
                const limit = getPlanLimit(selectedPlan);
                
                // Ajustar interface conforme o plano
                if (selectedPlan === 'Grátis') {
                    addMedicationBtn.style.display = 'none';
                    // Se houver mais de um medicamento, remove os excedentes
                    if (currentMedications > 1) {
                        removeExcessMedications(1);
                    }
                } else if (selectedPlan === 'Pessoal') {
                    if (currentMedications < 5) {
                        addMedicationBtn.style.display = 'block';
                    } else {
                        addMedicationBtn.style.display = 'none';
                    }
                } else if (selectedPlan === 'Premium') {
                    addMedicationBtn.style.display = 'block';
                }
                
                // Se excedeu o limite, mostrar notificação
                if (currentMedications > limit) {
                    showNotification('error', 'Limite excedido', 
                        `O plano ${selectedPlan} permite apenas ${limit} medicamento(s). 
                        Remova ${currentMedications - limit} medicamento(s) para continuar.`);
                }
            }
            
            // Remover medicamentos excedentes
            function removeExcessMedications(limit) {
                const medicationBlocks = document.querySelectorAll('.medication-block');
                const blocksToRemove = Array.from(medicationBlocks).slice(limit);
                
                blocksToRemove.forEach(block => {
                    block.remove();
                });
                
                // Atualiza o contador de medicamentos
                medicationCount = limit;
                updateMedicationTitles();
            }
            
            // Seleção de plano
            planCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Armazena o plano atual como anterior
                    previousPlan = selectedPlan;
                    
                    // Armazena o novo plano selecionado
                    const newPlan = this.dataset.plan;
                    
                    // Verifica se o novo plano tem limite menor que o atual
                    const currentMedications = document.querySelectorAll('.medication-block').length;
                    const newLimit = getPlanLimit(newPlan);
                    const previousLimit = getPlanLimit(previousPlan);
                    
                    // Se o novo plano tem limite menor e há medicamentos excedentes
                    if (newLimit < currentMedications && currentMedications > 1) {
                        // Mostra notificação de confirmação
                        showNotification('warning', 'Limite de medicamentos', 
                            `O plano ${newPlan} permite apenas ${newLimit} medicamento(s). 
                            Você possui ${currentMedications} medicamentos. Deseja remover os excedentes?`,
                            true, // Adiciona botões de confirmação
                            function() {
                                // Se confirmar, remove os medicamentos excedentes
                                removeExcessMedications(newLimit);
                                // Atualiza o plano selecionado
                                selectedPlan = newPlan;
                                // Atualiza a interface
                                planCards.forEach(c => c.classList.remove('selected'));
                                card.classList.add('selected');
                                // Verifica o limite novamente
                                checkMedicationLimit();
                            },
                            function() {
                                // Se cancelar, mantém o plano anterior
                                if (previousPlan) {
                                    planCards.forEach(c => {
                                        c.classList.remove('selected');
                                        if (c.dataset.plan === previousPlan) {
                                            c.classList.add('selected');
                                        }
                                    });
                                }
                            }
                        );
                    } else {
                        // Se não há excedentes, atualiza normalmente
                        selectedPlan = newPlan;
                        planCards.forEach(c => c.classList.remove('selected'));
                        this.classList.add('selected');
                        checkMedicationLimit();
                    }
                });
            });
            
            // Envio do formulário
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validar se um plano foi selecionado
                if (!selectedPlan) {
                    showNotification('error', 'Plano não selecionado', 'Por favor, selecione um plano para continuar.');
                    return;
                }
                
                // Validar método de pagamento (se não for gratuito)
                const metodoPagamento = document.getElementById('metodo_pagamento').value;
                if (selectedPlan !== 'Grátis' && !metodoPagamento) {
                    showNotification('error', 'Método de pagamento', 'Por favor, selecione um método de pagamento.');
                    return;
                }
                
                // Verificar se o número de medicamentos está dentro do limite
                const medicationBlocks = document.querySelectorAll('.medication-block');
                const currentMedications = medicationBlocks.length;
                const limit = getPlanLimit(selectedPlan);
                
                if (currentMedications > limit) {
                    showNotification('error', 'Limite excedido', 
                        `O plano ${selectedPlan} permite apenas ${limit} medicamento(s). 
                        Remova ${currentMedications - limit} medicamento(s) para continuar.`);
                    return;
                }
                
                // Validar todas as datas dos medicamentos
                let allDatesValid = true;
                medicationBlocks.forEach((block, index) => {
                    const dateInput = block.querySelector(`input[name="data_compra"]`);
                    if (dateInput && !dateInput.value) {
                        allDatesValid = false;
                        showNotification('error', 'Data obrigatória', `Por favor, informe a data da compra do ${index === 0 ? 'medicamento principal' : `medicamento ${index + 1}`}.`);
                    }
                });
                
                if (!allDatesValid) {
                    return;
                }
                
                // Coletar dados do formulário
                const formData = {
                    nome: document.getElementById('nome').value,
                    email: document.getElementById('email').value,
                    whatsapp: document.getElementById('whatsapp').value,
                    lgpd: document.getElementById('lgpd').checked,
                    medicamentos: [],
                    plano: selectedPlan,
                    metodo_pagamento: metodoPagamento,
                    codigo_founder: document.getElementById('codigo_founder').value
                };
                
                // Coletar dados dos medicamentos
                medicationBlocks.forEach((block, index) => {
                    const medicamento = {
                        nome: document.getElementById(`medicamento-${index}`).value,
                        dosagem: document.getElementById(`dosagem-${index}`).value,
                        marca: document.getElementById(`marca-${index}`).value,
                        quantidade: document.getElementById(`quantidade-${index}`).value,
                        forma_uso: document.getElementById(`forma_uso-${index}`).value,
                        data_compra: document.getElementById(`data_compra-${index}`).value,
                        dias_antes_alerta: document.getElementById(`dias_antes_alerta-${index}`).value
                    };
                    formData.medicamentos.push(medicamento);
                });
                
                // Exibir resumo
                displaySummary(formData);
                
                // Esconder formulário e mostrar resumo
                formContainer.style.display = 'none';
                summaryContainer.style.display = 'block';
                
                // Simular envio para o backend
                console.log('Dados enviados:', formData);
                showNotification('success', 'Cadastro realizado!', 'Seus dados foram enviados com sucesso.');
            });
            
            // Exibir resumo do cadastro
            function displaySummary(data) {
                // Preencher dados do usuário
                document.getElementById('summary-nome').textContent = data.nome;
                document.getElementById('summary-email').textContent = data.email;
                document.getElementById('summary-whatsapp').textContent = data.whatsapp;
                
                // Preencher medicamentos
                const medicationsContainer = document.getElementById('summary-medications');
                medicationsContainer.innerHTML = '';
                data.medicamentos.forEach((med, index) => {
                    const medBlock = document.createElement('div');
                    medBlock.className = 'medication-summary';
                    let medTitle = 'Medicamento principal';
                    if (index > 0) {
                        medTitle = `Medicamento ${index + 1}`;
                    }
                    medBlock.innerHTML = `
                        <div class="medication-summary-title">${medTitle}</div>
                        <div class="summary-item">
                            <div class="summary-label">Nome:</div>
                            <div class="summary-value">${med.nome}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Dosagem:</div>
                            <div class="summary-value">${med.dosagem}</div>
                        </div>
                        ${med.marca ? `
                        <div class="summary-item">
                            <div class="summary-label">Marca:</div>
                            <div class="summary-value">${med.marca}</div>
                        </div>
                        ` : ''}
                        ${med.quantidade ? `
                        <div class="summary-item">
                            <div class="summary-label">Quantidade:</div>
                            <div class="summary-value">${med.quantidade}</div>
                        </div>
                        ` : ''}
                        <div class="summary-item">
                            <div class="summary-label">Posologia:</div>
                            <div class="summary-value">${med.forma_uso}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Data da compra:</div>
                            <div class="summary-value">${formatDate(med.data_compra)}</div>
                        </div>
                        ${med.dias_antes_alerta ? `
                        <div class="summary-item">
                            <div class="summary-label">Aviso com:</div>
                            <div class="summary-value">${med.dias_antes_alerta} dias de antecedência</div>
                        </div>
                        ` : ''}
                    `;
                    medicationsContainer.appendChild(medBlock);
                });
                
                // Preencher plano e pagamento
                document.getElementById('summary-plano').textContent = data.plano;
                document.getElementById('summary-metodo-pagamento').textContent = data.metodo_pagamento || 'Não aplicável';
                if (data.codigo_founder) {
                    document.getElementById('summary-codigo-founder').textContent = data.codigo_founder;
                    document.getElementById('summary-codigo-founder-item').style.display = 'flex';
                } else {
                    document.getElementById('summary-codigo-founder-item').style.display = 'none';
                }
                
                // Configurar link do WhatsApp
                const whatsappLink = document.getElementById('whatsapp-link');
                const firstMed = data.medicamentos[0];
                const whatsappMessage = `Oi! Acabei de me cadastrar. Meu remédio principal é ${firstMed.nome} (dosagem ${firstMed.dosagem}). Quero receber o comparativo e os alertas.`;
                const whatsappNumber = '5511999999999'; // Número a ser configurado
                whatsappLink.href = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(whatsappMessage)}`;
                
                // Configurar botão de assinatura
                const subscribeBtn = document.getElementById('subscribe-btn');
                if (data.plano === 'Grátis') {
                    subscribeBtn.style.display = 'none';
                } else {
                    subscribeBtn.style.display = 'block';
                    subscribeBtn.addEventListener('click', function() {
                        // Aqui seria redirecionado para a página de pagamento
                        showNotification('success', 'Redirecionando...', 'Você será redirecionado para a página de pagamento.');
                        // window.location.href = '/pagamento';
                    });
                }
            }
            
            // Formatar data
            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(dateString).toLocaleDateString('pt-BR', options);
            }
            
            // Sistema de notificações
            function showNotification(type, title, message, showButtons = false, confirmCallback = null, cancelCallback = null) {
                // Limpa botões anteriores se existirem
                const existingButtons = notification.querySelectorAll('.notification-buttons');
                existingButtons.forEach(btn => btn.remove());
                
                notification.className = 'notification ' + type;
                document.getElementById('notification-title').textContent = title;
                document.getElementById('notification-message').textContent = message;
                
                if (showButtons) {
                    const buttonsContainer = document.createElement('div');
                    buttonsContainer.className = 'notification-buttons';
                    
                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'btn btn-success';
                    confirmBtn.textContent = 'Sim, remover';
                    confirmBtn.addEventListener('click', function() {
                        if (confirmCallback) confirmCallback();
                        notification.style.display = 'none';
                    });
                    
                    const cancelBtn = document.createElement('button');
                    cancelBtn.className = 'btn btn-outline';
                    cancelBtn.textContent = 'Cancelar';
                    cancelBtn.addEventListener('click', function() {
                        if (cancelCallback) cancelCallback();
                        notification.style.display = 'none';
                    });
                    
                    buttonsContainer.appendChild(confirmBtn);
                    buttonsContainer.appendChild(cancelBtn);
                    notification.appendChild(buttonsContainer);
                }
                
                notification.style.display = 'block';
                
                // Se não tiver botões, fecha automaticamente após 5 segundos
                if (!showButtons) {
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 5000);
                }
            }
            
            // Fechar notificação
            notificationClose.addEventListener('click', function() {
                notification.style.display = 'none';
            });
        });
    </script>
</body>
</html>

